<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch ƒê∆°n h√†ng</title>
    <link rel="stylesheet" href="/css/admin/orders1.css">
    <link rel="stylesheet" href="/css/headeradmin.css">
</head>
<body>
    <%- include('../partialsadmin/headeradmin') %>

    <main>
        <div class="content">
            <h1>Danh s√°ch t·∫•t c·∫£ ƒë∆°n h√†ng</h1>
            <br>
            <div class="sales-female">
                
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n Ng∆∞·ªùi D√πng</th>
                            <th>T·ªïng Ti·ªÅn</th>
                            <th>Ph∆∞∆°ng Th·ª©c Thanh To√°n</th>
                            <th>Tr·∫°ng Th√°i ƒê∆°n H√†ng</th>
                            <th>Ng√†y ƒê·∫∑t</th>
                            <th>Ng∆∞·ªùi d√πng s√°t nh·∫≠n</th>
                            <th>H√†nh ƒê·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% orders.forEach(order => { %>
                            <tr>
                                <td><%= order.id %></td>
                                <td><%= order.tenusers %></td>
                                <td><%= order.total_price %></td>
                                <td><%= order.payment_method %></td>
                                
                                <td>
                                    <select id="status-<%= order.id %>" <%= (order.order_status === 'ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao' || order.order_status === 'Kh√°ch h√†ng kh√¥ng nh·∫≠n h√†ng') ? 'disabled' : '' %>>
                                        <option value="ƒê√£ t·∫°o ƒë∆°n h√†ng" <%= order.order_status === 'ƒê√£ t·∫°o ƒë∆°n h√†ng' ? 'selected' : '' %>>ƒê√£ t·∫°o ƒë∆°n h√†ng</option>
                                        <option value="ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c giao" <%= order.order_status === 'ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c giao' ? 'selected' : '' %>>ƒê∆°n h√†ng ƒëang ƒë∆∞·ª£c giao</option>
                                        <option value="ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao" <%= order.order_status === 'ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao' ? 'selected' : '' %>>ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao</option>
                                        <option value="Kh√°ch h√†ng kh√¥ng nh·∫≠n h√†ng" <%= order.order_status === 'Kh√°ch h√†ng kh√¥ng nh·∫≠n h√†ng' ? 'selected' : '' %>>Kh√°ch h√†ng kh√¥ng nh·∫≠n h√†ng</option>
                                    </select>
                                </td>
                                <td><%= order.order_date %></td>
                                <td><%= order.user_confirmation %></td>
                                <td>
                                    <% if (order.order_status === 'ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao' && order.user_confirmation === 'ƒê√£ nh·∫≠n') { %>
                                        ‚úÖ
                                    <% } else if (order.order_status === 'ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c giao' && order.user_confirmation === 'Ch∆∞a nh·∫≠n') { %>
                                        üîÑ
                                    <% } else if (order.order_status === 'Kh√°ch h√†ng kh√¥ng nh·∫≠n h√†ng' && order.user_confirmation === 'Ch∆∞a nh·∫≠n') { %>
                                        ‚ùå
                                    <% } else { %>
                                        <button onclick="updateOrderStatus('<%= order.id %>')">C·∫≠p nh·∫≠t</button>
                                    <% } %>
                                    <a href="/orders1/<%= order.id %>" class="btn-detail">Xem chi ti·∫øt</a>
                                </td>
                                
                                
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        function updateOrderStatus(orderId) {
            const newStatus = document.getElementById(`status-${orderId}`).value;
            fetch(`/orders1/${orderId}/updateStatus`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ order_status: newStatus })
            })
            .then(response => {
                if (response.ok) {
                    alert('C·∫≠p nh·∫≠t th√†nh c√¥ng!');
                    location.reload();
                } else {
                    alert('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i.');
                }
            })
            .catch(error => console.error('L·ªói:', error));
        }
    </script>
</body>
</html>
